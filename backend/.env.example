# =============================================================================
# TradeTally Environment Configuration
# =============================================================================
# This file contains all configurable environment variables for TradeTally.
# Copy this file to .env and modify values as needed.
#
# For Docker deployments, these can be set in docker-compose.yaml or a .env file.
# =============================================================================

# =============================================================================
# DATABASE CONFIGURATION (Required)
# =============================================================================
DB_HOST=localhost
DB_PORT=5432
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_NAME=tradetally_db

# =============================================================================
# JWT/AUTHENTICATION (Required)
# =============================================================================
# Secret key for signing JWTs - MUST be changed in production
JWT_SECRET=your_jwt_secret_key_here_should_be_very_long_and_secure
JWT_EXPIRES_IN=7d

# Token expiration for mobile apps
ACCESS_TOKEN_EXPIRE=15m
REFRESH_TOKEN_EXPIRE=30d

# OAuth2 token expiration (for third-party integrations)
OAUTH2_ACCESS_TOKEN_EXPIRE=1h
OAUTH2_REFRESH_TOKEN_EXPIRE=30d

# OAuth2/OIDC signing keys
# Set either inline PEM values (escaped with \n) OR file paths.
# Never commit private keys.
OAUTH_PRIVATE_KEY=
OAUTH_PRIVATE_KEY_PATH=
OAUTH_PUBLIC_KEY=
OAUTH_PUBLIC_KEY_PATH=

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================
NODE_ENV=production
PORT=3000

# Frontend URL (used for CORS, email links, etc.)
FRONTEND_URL=http://localhost:5173

# Additional CORS origins (comma-separated)
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# API base URL (for Swagger documentation)
API_BASE_URL=http://localhost:3000

# Maximum file upload size in bytes (default: 50MB)
MAX_FILE_SIZE=52428800

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
# Available levels: DEBUG, INFO, WARN, ERROR
# DEBUG shows all logs, INFO shows info/warn/error, WARN shows warn/error, ERROR shows error only
LOG_LEVEL=INFO

# Enable verbose import debugging
DEBUG_IMPORT=false

# =============================================================================
# EMAIL CONFIGURATION (Optional)
# =============================================================================
# Required for: password reset, email verification, trial expiration emails
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=
EMAIL_PASS=
EMAIL_FROM=noreply@yourdomain.com
EMAIL_DOMAIN=yourdomain.com

# DKIM Configuration (Recommended for better email deliverability)
DKIM_PRIVATE_KEY=
DKIM_SELECTOR=default

# Show detailed authentication errors when email is not configured
# Set to 'true' to help debug login issues on self-hosted instances
DETAILED_AUTH_ERRORS=false

# =============================================================================
# EXTERNAL API KEYS (Optional)
# =============================================================================
# Finnhub - Real-time quotes, CUSIP resolution, company profiles
# Get a free API key at: https://finnhub.io/
FINNHUB_API_KEY=

# Finnhub Rate Limits - Configure based on your Finnhub plan:
# Free plan: 60 calls/min, ~1 call/sec
# Basic plan: 150 calls/min, ~30 calls/sec
# Professional plan: 300 calls/min, ~60 calls/sec
# If not set, defaults to Free plan limits (60/min, 1/sec)
FINNHUB_RATE_LIMIT_PER_MINUTE=60
FINNHUB_RATE_LIMIT_PER_SECOND=1

# Alpha Vantage - Historical chart data for trade visualization
# Get a free API key at: https://www.alphavantage.co/
ALPHA_VANTAGE_API_KEY=

# OpenFIGI - Alternative CUSIP/ISIN resolution
# Get a free API key at: https://www.openfigi.com/
OPENFIGI_API_KEY=

# CoinGecko - Cryptocurrency prices and market data
# Optional: Works without API key (5-15 calls/min), but for stable 30 calls/min:
# 1. Create a free account at: https://www.coingecko.com/
# 2. Go to Developer Dashboard: https://www.coingecko.com/en/developers/dashboard
# 3. Generate a Demo API key (free tier)
COINGECKO_API_KEY=

# =============================================================================
# FEATURE TOGGLES - BACKGROUND SERVICES
# =============================================================================
# These control background services that consume database connections and resources.
# For minimal self-hosted setups, consider disabling services you don't need.
# Set to 'false' to disable, any other value (or unset) enables the service.

# Price monitoring - polls external APIs for real-time prices and triggers alerts
# Requires: FINNHUB_API_KEY
ENABLE_PRICE_MONITORING=true

# Trade enrichment - background processing for CUSIP resolution, strategy classification, news
# Requires: Various API keys depending on enrichment type
ENABLE_TRADE_ENRICHMENT=true

# Job recovery - automatically recovers stuck background jobs
ENABLE_JOB_RECOVERY=true

# Gamification - processes achievements, challenges, leaderboards
ENABLE_GAMIFICATION=true

# Trial emails - sends trial expiration reminder emails
# Requires: Email configuration
ENABLE_TRIAL_EMAILS=true

# Options scheduler - automatically closes expired options positions
ENABLE_OPTIONS_SCHEDULER=true

# Backup scheduler - automated database backups
ENABLE_BACKUP_SCHEDULER=true

# Enrichment cache cleanup - cleans up old cached enrichment data
ENABLE_ENRICHMENT_CACHE_CLEANUP=true

# AI-powered CUSIP resolution - uses AI to resolve unknown CUSIPs
# Requires: AI provider configured in admin settings
ENABLE_AI_CUSIP_RESOLUTION=false

# =============================================================================
# FEATURE TOGGLES - OTHER
# =============================================================================
# Run database migrations on startup
RUN_MIGRATIONS=true

# Skip base schema during migrations (advanced, rarely needed)
SKIP_BASE_SCHEMA=false

# Enable Swagger API documentation at /api-docs
ENABLE_SWAGGER=true

# Enable behavioral analytics features
FEATURES_BEHAVIORAL_ANALYTICS_ENABLED=true

# =============================================================================
# REGISTRATION & USER MANAGEMENT
# =============================================================================
# Registration mode controls who can create accounts:
# - open: Anyone can register
# - approval: Registration requires admin approval
# - disabled: No new registrations allowed
REGISTRATION_MODE=open

# =============================================================================
# MOBILE APP SUPPORT
# =============================================================================
# Maximum devices a user can have registered
MAX_DEVICES_PER_USER=10

# Track device information for mobile apps
ENABLE_DEVICE_TRACKING=true

# =============================================================================
# ANALYTICS (Optional)
# =============================================================================
# Self-hosted analytics (Plausible, Umami, etc.)
VITE_ANALYTICS_DOMAIN=
VITE_ANALYTICS_SITE_ID=

# Frontend API URL (for Vite build)
VITE_API_URL=http://localhost/api

# =============================================================================
# BROKER SYNC CONFIGURATION (Optional)
# =============================================================================
# Encryption key for storing broker credentials (required for broker sync)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
BROKER_ENCRYPTION_KEY=

# Schwab OAuth Configuration (required for Schwab sync)
# Register at: https://developer.schwab.com
# Note: Schwab app approval can take a few days
SCHWAB_CLIENT_ID=
SCHWAB_CLIENT_SECRET=
SCHWAB_REDIRECT_URI=http://localhost:3000/api/broker-sync/connections/schwab/callback

# Enable broker sync scheduler (automatically syncs connected brokers)
ENABLE_BROKER_SYNC_SCHEDULER=true

# =============================================================================
# MINIMAL SELF-HOSTED CONFIGURATION
# =============================================================================
# For a minimal self-hosted setup with lowest resource usage, copy these settings:
#
# ENABLE_PRICE_MONITORING=false
# ENABLE_TRADE_ENRICHMENT=false
# ENABLE_JOB_RECOVERY=false
# ENABLE_GAMIFICATION=false
# ENABLE_TRIAL_EMAILS=false
# ENABLE_OPTIONS_SCHEDULER=false
# ENABLE_BACKUP_SCHEDULER=false
# ENABLE_ENRICHMENT_CACHE_CLEANUP=false
# LOG_LEVEL=ERROR
#
# This disables all background services and reduces database connection usage.
# =============================================================================
